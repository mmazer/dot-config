#!/bin/bash

TODO=${MY_TODO:-$HOME/.todo}

usage () {
    sed -e 's/^//' <<End
Usage: todo [-e] [-a text] [-h]
-a add todo
-e edit todo list in $TODO
-h show help
End
    exit 1
}

check_todo () {
if [ ! -f "$1" ]; then
    echo "creating todo file: $1"
    touch "$1"
    if [ $? -ne 0 ]; then
        echo "error creating todo file $1: $?"
        exit 1
    fi
    chmod 644 "$1"
fi
}

list_todo () {
    echo "checking todo file $TOOO"
    check_todo $TODO
    cat $TODO
}
action="list"
while getopts aeh opt
do case "$opt" in
    a) action="add";;
    e) action="edit";;
    h) action="help";;
    \?) usage;;
    esac
done

check_todo $TODO

case $action in
    help) usage;;
    edit) $EDITOR "$TODO" ;;
    add) 
        shift $((OPTIND-1))
        echo "- $@" >> $TODO
        ;;
    list)
        cat $TODO
        ;;
    *)
        ;;
esac

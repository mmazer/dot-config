#!/bin/bash

usage() {
    echo "$0 [-l] [dir]"
    exit 1
}

showlink() {
    checkdir ${WWW}
    ls -l ${WWW}
    exit 1
}

checkdir() {
if [ ! -d "$1" ]; then
    echo "$1 is not a valid directory"
    exit 1;
fi

}
WWW=/Users/Shared/apache/www
TS=`date +%y%m%d`

while getopts lh o
do case "$o" in
    l) showlink;;
    h) usage;;
    *) usage;;
esac
done
shift $(($OPTIND - 1))

if [ $# -eq 0 ]; then
    usage
fi

SRC=$1

checkdir ${SRC}

if [ -e ${WWW} ] &&  [ ! -L ${WWW} ]; then
    echo "Warning: ${WWW} is not a symbolic link. Continue? yY/nN"
    read CONT

    case $CONT in
        y|Y) 
            echo "Resetting ${WWW} to ${SRC}"
            mv ${WWW} ${WWW}~${TS}
            ;;
        *) echo "Leaving ${WWW} unchanged"; exit 0;;
    esac
fi

rm -rf ${WWW}
ln -s ${SRC} ${WWW}
showlink
